(async function(){window.KGTD=window.KGTD||{};KGTD.convertLocalTimeToLocalTimeStringWithTimeZone=function(a){const b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),k=a.getMinutes(),f=a.getSeconds();var g=a.getTimezoneOffset();a=Math.floor(Math.abs(g)/60);g=Math.abs(g)%60;return`${b.toString().padStart(4,"0")}-${c.toString().padStart(2,"0")}-${d.toString().padStart(2,"0")}T${e.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}${0<=a?"+":"-"}${a.toString().padStart(2,
"0")}:${g.toString().padStart(2,"0")}`};KGTD.convertLocalTimeStringWithTimeZoneToLocalTime=function(a){return new Date(a)};KGTD.saveAThing=async function(){var a=document.getElementById("input-content").value;document.getElementById("input-content").value="";if(0===a.length)alert("\u7a7a\u5185\u5bb9\u4e0d\u80fd\u4fdd\u5b58");else{var b=KGTD.sqliteDB.exec("SELECT LOWER(HEX(RANDOMBLOB(16))) || '-' || LOWER(HEX(RANDOMBLOB(4))) || '-' || LOWER(HEX(RANDOMBLOB(4))) || '-' || LOWER(HEX(RANDOMBLOB(4))) || '-' || LOWER(HEX(RANDOMBLOB(12)))")[0].values[0][0],
c=0;a.includes("\u6bcf")&&(c=1);a=`INSERT INTO things (id,content,local_created_at,is_recurring,is_completed,\
          local_completed_at) VALUES ('${b}','${a}','${KGTD.convertLocalTimeToLocalTimeStringWithTimeZone(new Date)}',${c},0,'')`;KGTD.sqliteDB.run(a);await KSQLITE.writeSqliteDBtoIndexedDB();document.getElementById("input-content").style.height=KGTD.originalHeightOfTextarea+"px";KGTD.updateThingsData();KGTD.updateToBeCompletedThingsList();KGTD.updateAllThingsList()}};KGTD.createThingsTable=function(){var a=!0;0===KGTD.sqliteDB.exec("SELECT name FROM sqlite_master WHERE type='table' AND name='things'").length&&
(a=!1);a||(KGTD.sqliteDB.exec("CREATE TABLE things (    id VARCHAR(36) PRIMARY KEY,    content TEXT NOT NULL CHECK(length(content) <= 1000),    local_created_at VARCHAR(25) NOT NULL,    is_recurring BOOLEAN DEFAULT 0,    is_completed BOOLEAN DEFAULT 0,    local_completed_at VARCHAR(25)    );"),KSQLITE.writeSqliteDBtoIndexedDB())};KGTD.updateThingsData=function(){KGTD.thingsData=[];const a=KGTD.sqliteDB.exec("SELECT * FROM things");for(let b=0;b<a[0].values.length;b++){let c={};for(let d=0;d<a[0].columns.length;d++)c[a[0].columns[d]]=
a[0].values[b][d];c._local_created_at=(new Date(c.local_created_at)).toLocaleString().replace(/\//g,"-");KGTD.thingsData.push(c)}};KGTD.updateAllThingsList=function(){const a=document.getElementById("all-things-list");a.innerHTML="";let b=KGTD.thingsData.sort((c,d)=>new Date(d.local_created_at)-new Date(c.local_created_at));for(let c=0;c<b.length;c++){const d=b[c];if(d.is_hidden)continue;const e=document.createElement("li");e.className="py-2 px-4 border-b border-gray-300";e.setAttribute("data-uuid",
d.id);let k=d.is_recurring?"fa-sync":"fa-circle",f="";f=d.is_completed?`
                    <div class="text-xs text-gray-400">\u521b\u5efa: ${d._local_created_at}</div>
                <div class="text-xs text-gray-400">\u5b8c\u6210: ${d._local_completed_at}</div>
                    `:`
                <div class="text-xs text-gray-400">\u521b\u5efa: ${d._local_created_at}</div>
                `;e.innerHTML=`
            <i class="fas text-orange-300 ${k} text-xs mr-2"></i>
            <span class="task-text">${d.content}</span>
            <input type="text" class="edit-input hidden" value="${d.content}" onblur="KGTD.saveEdit(this)" />
            
            </div>
            <div>
            <div class="text-xs text-gray-400">
                ${f}
            </div>`;a.appendChild(e)}};KGTD.addHiddenFieldToThingsTable=function(){let a=KGTD.sqliteDB.exec("PRAGMA table_info('things')")[0].values,b=!1;for(let c=0;c<a.length;c++)if("is_hidden"===a[c][1]){b=!0;break}b||(console.log("\u6dfb\u52a0\u4e86'\u662f\u5426\u9690\u85cf'\u5b57\u6bb5\u5230'things'\u8868"),KGTD.sqliteDB.run("ALTER TABLE things ADD COLUMN is_hidden INTEGER DEFAULT 0",function(){console.log("\u6dfb\u52a0\u4e86'\u662f\u5426\u9690\u85cf'\u5b57\u6bb5\u5230'things'\u8868")}),KSQLITE.writeSqliteDBtoIndexedDB(),
KGTD.updateThingsData())};KGTD.updateToBeCompletedThingsList=function(){const a=document.getElementById("to-be-completed-things-list");a.innerHTML="";let b=KGTD.thingsData.sort((c,d)=>new Date(d.local_created_at)-new Date(c.local_created_at));for(let c=0;c<b.length;c++){const d=b[c];if(d.is_completed)continue;const e=document.createElement("li");e.className="py-2 px-4 border-b border-gray-300";e.setAttribute("data-uuid",d.id);e.innerHTML=`
            <i class="fas text-orange-300 ${d.is_recurring?"fa-sync":"fa-circle"} text-xs mr-2"></i>
            <span class="task-text">${d.content}</span>
            <input type="text" class="edit-input hidden" value="${d.content}" onblur="KGTD.saveEdit(this)" />
            <div class="inline justify-end float-right space-x-1 ml-1">
                <button class="bg-green-400 text-white rounded px-1 text-xs"
                    onclick="KGTD.editTask(this)">\u4fee\u6539
                </button>
                <button class="bg-red-200 text-white rounded px-1 text-xs"
                    onclick="KGTD.deleteTask(this)">\u5220\u9664
                </button>
                <button class="bg-blue-200 text-white rounded px-1 text-xs"
                    onclick="KGTD.finishTask(this)">\u5b8c\u6210
                </button>
            </div>
            <div>
                <div class="text-xs text-gray-400">\u521b\u5efa: ${d._local_created_at}</div>
            </div>
        `;a.appendChild(e)}};KGTD.updateCompletedThingsList=function(){const a=document.getElementById("completed-things-list");a.innerHTML="";let b=KGTD.thingsData.sort((d,e)=>new Date(e.local_created_at)-new Date(d.local_created_at));for(let d=0;d<b.length;d++){const e=b[d];if(e.is_completed&&!e.is_hidden){var c=new Date(e.local_completed_at);e._local_completed_at=c.getFullYear()+"-"+(c.getMonth()+1).toString().padStart(2,"0")+"-"+c.getDate().toString().padStart(2,"0")+" "+c.getHours().toString().padStart(2,
"0")+":"+c.getMinutes().toString().padStart(2,"0")+":"+c.getSeconds().toString().padStart(2,"0");c=document.createElement("li");c.className="py-2 px-4 border-b border-gray-300";c.setAttribute("data-uuid",e.id);c.innerHTML=`
            <i class="fas text-orange-300 ${e.is_recurring?"fa-sync":"fa-circle"} text-xs mr-2"></i>
            <span class="task-text">${e.content}</span>
            <input type="text" class="edit-input hidden" value="${e.content}" onblur="KGTD.saveEdit(this)" />
            <div class="inline justify-end float-right space-x-1 ml-1">                
                <button class="bg-blue-200 text-white rounded px-1 text-xs"
                    onclick="KGTD.hideTask(this)">\u9690\u85cf
                </button>    
                <button class="bg-red-200 text-white rounded px-1 text-xs"
                    onclick="KGTD.deleteTask(this)">\u5220\u9664
                </button>
                
            </div>
            <div>
                <div class="text-xs text-gray-400">\u521b\u5efa: ${e._local_created_at}</div>
                <div class="text-xs text-gray-400">\u5b8c\u6210: ${e._local_completed_at}</div>
            </div>
        `;a.appendChild(c)}}};KGTD.expandAndShrinkDisplay=function(a){var b=a.parentNode.querySelector(".elem-can-hidden");b.classList.contains("hidden")?(b.classList.remove("hidden"),b.classList.add("max-h-md"),b.classList.remove("max-h-0"),b.classList.remove("overflow-hidden")):(b.classList.add("hidden"),b.classList.remove("max-h-md"),b.classList.add("max-h-0"),b.classList.add("overflow-hidden"));a=a.parentNode.querySelector(".ico-of-change-state");a.classList.contains("fa-plus")?(a.classList.remove("fa-plus"),
a.classList.add("fa-minus")):(a.classList.remove("fa-minus"),a.classList.add("fa-plus"))};KGTD.editTask=function(a){var b=a.closest("li");a=b.querySelector(".task-text");b=b.querySelector(".edit-input");a.classList.toggle("hidden");b.classList.toggle("hidden");b.focus()};KGTD.saveEdit=function(a){console.log("===================");console.log("kgtd.saveedit");var b=a.closest("li");const c=b.querySelector(".task-text");c.textContent=a.value;c.classList.remove("hidden");a.classList.add("hidden");b=
b.getAttribute("data-uuid");a=a.value;console.log("uuid = ",b);console.log("content = ",a);KGTD.sqliteDB.run("UPDATE things SET content = ? WHERE id = ?",[a,b],function(){});KSQLITE.writeSqliteDBtoIndexedDB();KGTD.updateThingsData();KGTD.updateToBeCompletedThingsList();KGTD.updateAllThingsList()};KGTD.deleteTask=function(a){(a=a.closest("li").getAttribute("data-uuid"))&&KGTD.sqliteDB.run("DELETE FROM things WHERE id = ?",[a],function(){});KSQLITE.writeSqliteDBtoIndexedDB();KGTD.updateThingsData();
KGTD.updateToBeCompletedThingsList();KGTD.updateCompletedThingsList();KGTD.updateAllThingsList()};KGTD.finishTask=function(a){if(a=a.closest("li").getAttribute("data-uuid")){const b=KGTD.convertLocalTimeToLocalTimeStringWithTimeZone(new Date);console.log("formattedTime = ",b);KGTD.sqliteDB.run("UPDATE things SET is_completed = 1, local_completed_at = ? WHERE id = ?",[b,a],function(){})}KSQLITE.writeSqliteDBtoIndexedDB();KGTD.updateThingsData();KGTD.updateToBeCompletedThingsList();KGTD.updateCompletedThingsList();
KGTD.updateAllThingsList()};KGTD.hideTask=function(a){(a=a.closest("li").getAttribute("data-uuid"))&&KGTD.sqliteDB.run("UPDATE things SET is_hidden = 1 WHERE id = ?",[a],function(){});KSQLITE.writeSqliteDBtoIndexedDB();KGTD.updateThingsData();KGTD.updateCompletedThingsList();KGTD.updateAllThingsList()};KGTD.sqliteDB=await KSQLITE.createSqliteDB();KGTD.createThingsTable();KGTD.addHiddenFieldToThingsTable();KGTD.thingsData=void 0;"complete"===document.readyState?(KGTD.updateThingsData(),KGTD.updateToBeCompletedThingsList(),
KGTD.updateCompletedThingsList(),KGTD.updateAllThingsList()):document.addEventListener("DOMContentLoaded",function(){KGTD.updateThingsData();KGTD.updateToBeCompletedThingsList();KGTD.updateCompletedThingsList();KGTD.updateALLThingsList()});const h=document.getElementById("input-content");KGTD.originalHeightOfTextarea=document.getElementById("input-content").offsetHeight;h.addEventListener("input",()=>{h.style.height="auto";h.style.height=h.scrollHeight+"px"})})();
